DROP TABLE PLAYER_STORE;
DROP TABLE STORAGE;
DROP TABLE RECIPE_INGRE;
DROP TABLE PLAYER_RECIPE;
DROP TABLE STORE;
DROP TABLE RECIPE;
DROP TABLE INGRE;
DROP TABLE PLAYER;

DROP SEQUENCE SEQ_INGRE_NO;
DROP SEQUENCE SEQ_RECIPE_NO;



CREATE TABLE PLAYER
(
    PLAYER_NAME    VARCHAR2(30) NOT NULL,
    PLAYER_ID    VARCHAR2(20) NOT NULL,
    PLAYER_PASS    VARCHAR2(20) NOT NULL,
    PLAYER_EMAIL    VARCHAR2(50) NOT NULL,
    PLAYER_GOLD    NUMBER DEFAULT 10000,
    PLAYER_EXP    NUMBER DEFAULT 0
);

COMMENT ON COLUMN PLAYER.PLAYER_NAME IS '닉네임';

COMMENT ON COLUMN PLAYER.PLAYER_ID IS '아이디';

COMMENT ON COLUMN PLAYER.PLAYER_PASS IS '비밀번호';

COMMENT ON COLUMN PLAYER.PLAYER_EMAIL IS '이메일';

COMMENT ON COLUMN PLAYER.PLAYER_GOLD IS '자금';

COMMENT ON COLUMN PLAYER.PLAYER_EXP IS '경험치';

COMMENT ON TABLE PLAYER IS '회원';

CREATE UNIQUE INDEX PLAYER_PK ON PLAYER
( PLAYER_NAME );

ALTER TABLE PLAYER
  ADD CONSTRAINT PLAYER_PK PRIMARY KEY ( PLAYER_NAME )
USING INDEX PLAYER_PK;

INSERT INTO PLAYER VALUES('관리자', 'admin01', 'admin01', 'admin01@greedy.com', 9999999, 9999999);
INSERT INTO PLAYER VALUES('박완규', 'user01', 'pass01', 'user01', 10000, 0);
INSERT INTO PLAYER VALUES('김지수', 'user02', 'pass02', 'user02', 10000, 0);
INSERT INTO PLAYER VALUES('허희만', 'user03', 'pass03', 'user03', 10000, 0);
INSERT INTO PLAYER VALUES('이동주', 'user04', 'pass04', 'user04', 10000, 0);



CREATE TABLE INGRE
(
    INGRE_NO    NUMBER NOT NULL,
    INGRE_NAME    VARCHAR2(20) NOT NULL,
    INGRE_PRICE    NUMBER NOT NULL CHECK(INGRE_PRICE > 0),
    INGRE_IMG    VARCHAR2(1000)
);

COMMENT ON COLUMN INGRE.INGRE_NO IS '재료번호';

COMMENT ON COLUMN INGRE.INGRE_NAME IS '재료이름';

COMMENT ON COLUMN INGRE.INGRE_PRICE IS '재료가격';

COMMENT ON COLUMN INGRE.INGRE_IMG IS '이미지';

COMMENT ON TABLE INGRE IS '재료';

CREATE UNIQUE INDEX INGRE_PK ON INGRE
( INGRE_NO );

ALTER TABLE INGRE
  ADD CONSTRAINT INGRE_PK PRIMARY KEY ( INGRE_NO )
USING INDEX INGRE_PK;

CREATE SEQUENCE SEQ_INGRE_NO
NOCYCLE
NOCACHE;

INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '돼지고기', 1500, 'images\ingre\pork.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '소고기', 1500, 'images\ingre\beef.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '닭고기', 1500, 'images\ingre\chicken.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '소시지', 1500, 'images\ingre\sausages.png');

INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '생선', 1500, 'images\ingre\fish.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '문어', 1500, 'images\ingre\octopus.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '새우', 1500, 'images\ingre\shrimp.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '랍스터', 1500, 'images\ingre\lobster.png');

INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '고추장', 1500, 'images\ingre\hotSource.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '케찹', 1500, 'images\ingre\ketchup.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '마요네즈', 1500, 'images\ingre\mayonnaise.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '머스타드', 1500, 'images\ingre\mustard.png');

INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '야채', 1500, 'images\ingre\vegetables.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '버섯', 1500, 'images\ingre\mushroom.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '단무지', 1500, 'images\ingre\danmuji.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '계란', 1500, 'images\ingre\eggs.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '밀가루', 1500, 'images\ingre\flour.png');

INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '밥', 1500, 'images\ingre\rice.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '빵', 1500, 'images\ingre\bread.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '라면', 1500, 'images\ingre\ramen.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '김', 1500, 'images\ingre\gim.png');
INSERT INTO INGRE VALUES (SEQ_INGRE_NO.NEXTVAL, '물', 1500, 'images\ingre\water.png');




CREATE TABLE RECIPE
(
    RECIPE_NO    NUMBER NOT NULL,
    FOOD_NAME    VARCHAR2(20) NOT NULL,
    RECIPE_PRICE    NUMBER NOT NULL CHECK(RECIPE_PRICE > 0),
    FOOD_PRICE    NUMBER NOT NULL CHECK(FOOD_PRICE > 0),
    FOOD_EXP    NUMBER NOT NULL CHECK(FOOD_EXP > 0)
);

COMMENT ON COLUMN RECIPE.RECIPE_NO IS '레시피번호';

COMMENT ON COLUMN RECIPE.FOOD_NAME IS '요리이름';

COMMENT ON COLUMN RECIPE.RECIPE_PRICE IS '레시피가격';

COMMENT ON COLUMN RECIPE.FOOD_PRICE IS '요리가격';

COMMENT ON COLUMN RECIPE.FOOD_EXP IS '요리경험치';

COMMENT ON TABLE RECIPE IS '레시피';

CREATE UNIQUE INDEX 레시피_PK ON RECIPE
( RECIPE_NO );

ALTER TABLE RECIPE
 ADD CONSTRAINT 레시피_PK PRIMARY KEY ( RECIPE_NO )
 USING INDEX 레시피_PK;

CREATE SEQUENCE SEQ_RECIPE_NO
NOCYCLE
NOCACHE;

INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '제육볶음', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '닭볶음탕', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '부대찌개', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '비빔밥', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '볶음밥', 1500, 1500, 1500);

INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '라면', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '김밥', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '떡볶이', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '샌드위치', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '샐러드', 1500, 1500, 1500);

INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '치킨', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '돈까스', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '스테이크', 1500, 1500, 1500);

INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '초밥', 1500, 1500, 1500);
INSERT INTO RECIPE VALUES (SEQ_RECIPE_NO.NEXTVAL, '타코야키', 1500, 1500, 1500);



CREATE TABLE STORE
(
    STORE_LEVEL    NUMBER NOT NULL,
    STORE_NAME    VARCHAR2(20) NOT NULL,
    STORE_PRICE    NUMBER NOT NULL CHECK(STORE_PRICE > 0),
    MAX_RECIPE    NUMBER NOT NULL CHECK(MAX_RECIPE > 0),
    STORE_EXP    NUMBER NOT NULL CHECK(STORE_EXP > 0)
);

COMMENT ON COLUMN STORE.STORE_LEVEL IS '가게등급';

COMMENT ON COLUMN STORE.STORE_NAME IS '가게이름';

COMMENT ON COLUMN STORE.STORE_PRICE IS '가게가격';

COMMENT ON COLUMN STORE.MAX_RECIPE IS '최대레시피수';

COMMENT ON COLUMN STORE.STORE_EXP IS '경험치';

COMMENT ON TABLE STORE IS '가게';

CREATE UNIQUE INDEX STORE_PK ON STORE
( STORE_LEVEL );

ALTER TABLE STORE
 ADD CONSTRAINT STORE_PK PRIMARY KEY ( STORE_LEVEL )
 USING INDEX STORE_PK;

INSERT INTO STORE VALUES (1, '푸드트럭', 1, 3, 1);
INSERT INTO STORE VALUES (2, '포장마차', 100000, 3, 100000);
INSERT INTO STORE VALUES (3, '레스토랑', 10000000, 3, 10000000);


CREATE TABLE PLAYER_RECIPE
(
    PLAYER_NAME    VARCHAR2(30) NOT NULL,
    RECIPE_NO    NUMBER NOT NULL
    
);

COMMENT ON COLUMN PLAYER_RECIPE.PLAYER_NAME IS '닉네임';

COMMENT ON COLUMN PLAYER_RECIPE.RECIPE_NO IS '레시피번호';

COMMENT ON TABLE PLAYER_RECIPE IS '보유레시피';

CREATE UNIQUE INDEX PLAYER_RECIPE_PK ON PLAYER_RECIPE
( RECIPE_NO,PLAYER_NAME );

ALTER TABLE PLAYER_RECIPE
 ADD CONSTRAINT PLAYER_RECIPE_PK PRIMARY KEY ( RECIPE_NO,PLAYER_NAME )
 USING INDEX PLAYER_RECIPE_PK; 
 
ALTER TABLE PLAYER_RECIPE ADD FOREIGN KEY (PLAYER_NAME) REFERENCES PLAYER (PLAYER_NAME) ON DELETE CASCADE;
ALTER TABLE PLAYER_RECIPE ADD FOREIGN KEY (RECIPE_NO) REFERENCES RECIPE (RECIPE_NO) ON DELETE CASCADE;

INSERT INTO PLAYER_RECIPE VALUES ('박완규',1);
INSERT INTO PLAYER_RECIPE VALUES ('박완규',2);
INSERT INTO PLAYER_RECIPE VALUES ('박완규',3);

INSERT INTO PLAYER_RECIPE VALUES ('김지수',1);
INSERT INTO PLAYER_RECIPE VALUES ('김지수',2);
INSERT INTO PLAYER_RECIPE VALUES ('김지수',3);

INSERT INTO PLAYER_RECIPE VALUES ('허희만',1);
INSERT INTO PLAYER_RECIPE VALUES ('허희만',2);
INSERT INTO PLAYER_RECIPE VALUES ('허희만',3);

INSERT INTO PLAYER_RECIPE VALUES ('이동주',1);
INSERT INTO PLAYER_RECIPE VALUES ('이동주',2);
INSERT INTO PLAYER_RECIPE VALUES ('이동주',3);

CREATE TABLE RECIPE_INGRE
(
    RECIPE_NO    NUMBER NOT NULL,
    INGRE_NO    NUMBER NOT NULL
);

COMMENT ON COLUMN RECIPE_INGRE.RECIPE_NO IS '레시피번호';

COMMENT ON COLUMN RECIPE_INGRE.INGRE_NO IS '재료번호';

COMMENT ON TABLE RECIPE_INGRE IS '레시피재료';

CREATE UNIQUE INDEX RECIPE_INGRE_PK ON RECIPE_INGRE
( RECIPE_NO,INGRE_NO );

ALTER TABLE RECIPE_INGRE
 ADD CONSTRAINT RECIPE_INGRE_PK PRIMARY KEY ( RECIPE_NO,INGRE_NO )
 USING INDEX RECIPE_INGRE_PK; 
 
ALTER TABLE RECIPE_INGRE ADD FOREIGN KEY (INGRE_NO) REFERENCES INGRE (INGRE_NO) ON DELETE CASCADE;
ALTER TABLE RECIPE_INGRE ADD FOREIGN KEY (RECIPE_NO) REFERENCES RECIPE (RECIPE_NO) ON DELETE CASCADE;


INSERT INTO RECIPE_INGRE VALUES (1,1);
INSERT INTO RECIPE_INGRE VALUES (1,9);
INSERT INTO RECIPE_INGRE VALUES (1,13 );

INSERT INTO RECIPE_INGRE VALUES (2,3);
INSERT INTO RECIPE_INGRE VALUES (2,9);
INSERT INTO RECIPE_INGRE VALUES (2,13);

INSERT INTO RECIPE_INGRE VALUES (3,4);
INSERT INTO RECIPE_INGRE VALUES (3,13);
INSERT INTO RECIPE_INGRE VALUES (3,20);

CREATE TABLE STORAGE
(
    PLAYER_NAME    VARCHAR2(30) NOT NULL,
    INGRE_NO    NUMBER NOT NULL,
    INGRE_CNT    NUMBER NOT NULL
);

COMMENT ON COLUMN STORAGE.PLAYER_NAME IS '닉네임';

COMMENT ON COLUMN STORAGE.INGRE_NO IS '재료번호';

COMMENT ON COLUMN STORAGE.INGRE_CNT IS '재료개수';

COMMENT ON TABLE STORAGE IS '보유재료';

CREATE UNIQUE INDEX STORAGE_PK ON STORAGE
( PLAYER_NAME,INGRE_NO );

ALTER TABLE STORAGE
 ADD CONSTRAINT PLATER_INGRE_PK PRIMARY KEY ( PLAYER_NAME, INGRE_NO )
 USING INDEX PLATER_INGRE_PK;
 
ALTER TABLE STORAGE ADD FOREIGN KEY (PLAYER_NAME) REFERENCES PLAYER (PLAYER_NAME) ON DELETE CASCADE;
ALTER TABLE STORAGE ADD FOREIGN KEY (INGRE_NO) REFERENCES INGRE (INGRE_NO) ON DELETE CASCADE;

INSERT 
  INTO STORAGE A
(
  A.PLAYER_NAME
, A.INGRE_NO
, A.INGRE_CNT
) 
(
SELECT DISTINCT B.PLAYER_NAME
     , C.INGRE_NO
     , 3
  FROM PLAYER_RECIPE B
  JOIN RECIPE_INGRE  C ON ( B.RECIPE_NO = C.RECIPE_NO )
);

CREATE TABLE PLAYER_STORE
(
    PLAYER_NAME    VARCHAR2(30) NOT NULL,
    STORE_LEVEL    NUMBER NOT NULL
);

COMMENT ON COLUMN PLAYER_STORE.PLAYER_NAME IS '닉네임';

COMMENT ON COLUMN PLAYER_STORE.STORE_LEVEL IS '가게등급';

COMMENT ON TABLE PLAYER_STORE IS '보유가게';

CREATE UNIQUE INDEX PLAYER_STORE_PK ON PLAYER_STORE
( PLAYER_NAME );

ALTER TABLE PLAYER_STORE
 ADD CONSTRAINT PLAYER_STORE_PK PRIMARY KEY ( PLAYER_NAME )
 USING INDEX PLAYER_STORE_PK;
 
ALTER TABLE PLAYER_STORE ADD FOREIGN KEY (PLAYER_NAME) REFERENCES PLAYER (PLAYER_NAME) ON DELETE CASCADE;
ALTER TABLE PLAYER_STORE ADD FOREIGN KEY (STORE_LEVEL) REFERENCES STORE (STORE_LEVEL) ON DELETE CASCADE;

INSERT INTO PLAYER_STORE VALUES ('박완규',1);
INSERT INTO PLAYER_STORE VALUES ('김지수',2);
INSERT INTO PLAYER_STORE VALUES ('허희만',1);
INSERT INTO PLAYER_STORE VALUES ('이동주',3);

COMMIT;